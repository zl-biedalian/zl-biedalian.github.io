<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器的重绘与重排 | 小火柴的博客笔记</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="个人使用的笔记">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b02af158.css" as="style"><link rel="preload" href="/assets/js/app.df697a22.js" as="script"><link rel="preload" href="/assets/js/2.7d83501e.js" as="script"><link rel="preload" href="/assets/js/23.0e8e3223.js" as="script"><link rel="prefetch" href="/assets/js/10.e240a3f3.js"><link rel="prefetch" href="/assets/js/11.575cb3b0.js"><link rel="prefetch" href="/assets/js/12.3ff991d5.js"><link rel="prefetch" href="/assets/js/13.26c49407.js"><link rel="prefetch" href="/assets/js/14.c6bbd5c7.js"><link rel="prefetch" href="/assets/js/15.ddd33f09.js"><link rel="prefetch" href="/assets/js/16.b50e0d90.js"><link rel="prefetch" href="/assets/js/17.8b12949a.js"><link rel="prefetch" href="/assets/js/18.78f9b568.js"><link rel="prefetch" href="/assets/js/19.6c28fb1c.js"><link rel="prefetch" href="/assets/js/20.c55312e1.js"><link rel="prefetch" href="/assets/js/21.6240c172.js"><link rel="prefetch" href="/assets/js/22.7a0531a9.js"><link rel="prefetch" href="/assets/js/24.ae4b27cd.js"><link rel="prefetch" href="/assets/js/25.267d5425.js"><link rel="prefetch" href="/assets/js/26.0b7f1791.js"><link rel="prefetch" href="/assets/js/27.ad9b7815.js"><link rel="prefetch" href="/assets/js/28.01c71cdd.js"><link rel="prefetch" href="/assets/js/29.a43249ca.js"><link rel="prefetch" href="/assets/js/3.e698f975.js"><link rel="prefetch" href="/assets/js/30.5946cdb6.js"><link rel="prefetch" href="/assets/js/31.4ed5e15b.js"><link rel="prefetch" href="/assets/js/32.a6c4036d.js"><link rel="prefetch" href="/assets/js/33.32bd6b2e.js"><link rel="prefetch" href="/assets/js/34.b352a9bb.js"><link rel="prefetch" href="/assets/js/35.ba56cab8.js"><link rel="prefetch" href="/assets/js/36.54dc1f48.js"><link rel="prefetch" href="/assets/js/37.dd279648.js"><link rel="prefetch" href="/assets/js/38.536ec31f.js"><link rel="prefetch" href="/assets/js/4.ab898f5f.js"><link rel="prefetch" href="/assets/js/5.e7a2e834.js"><link rel="prefetch" href="/assets/js/6.0e33ec81.js"><link rel="prefetch" href="/assets/js/7.4115f5e1.js"><link rel="prefetch" href="/assets/js/8.3652c984.js"><link rel="prefetch" href="/assets/js/9.5d06d064.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b02af158.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/head.jpg" alt="小火柴的博客笔记" class="logo"> <span class="site-name can-hide">小火柴的博客笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/3eb294/" class="nav-link">学过的习</a></div><div class="nav-item"><a href="/pages/3fea03/" class="nav-link">踩过的坑</a></div><div class="nav-item"><a href="/pages/9a1e83/" class="nav-link">想过的事</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/3eb294/" class="nav-link">学过的习</a></div><div class="nav-item"><a href="/pages/3fea03/" class="nav-link">踩过的坑</a></div><div class="nav-item"><a href="/pages/9a1e83/" class="nav-link">想过的事</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>学过的习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e24a44/" class="sidebar-link">CSS的样式优先级权重</a></li><li><a href="/pages/7873d2/" class="sidebar-link">事件冒泡和事件捕获</a></li><li><a href="/pages/9c2bfc/" class="sidebar-link">js模块可以通过两种方式对外暴露函数</a></li><li><a href="/pages/991cc6/" class="sidebar-link">js中的内存泄漏和内存溢出</a></li><li><a href="/pages/cc931f/" class="sidebar-link">js作用域链</a></li><li><a href="/pages/17c816/" class="sidebar-link">控制台暴露vue</a></li><li><a href="/pages/515843/" class="sidebar-link">es5常用知识总结</a></li><li><a href="/pages/34049a/" class="sidebar-link">es6常用知识总结</a></li><li><a href="/pages/29f30f/" class="sidebar-link">es7常用知识总结</a></li><li><a href="/pages/6616c2/" class="sidebar-link">js模块化</a></li><li><a href="/pages/937e4b/" class="sidebar-link">nodeJs学习</a></li><li><a href="/pages/0a1991/" class="sidebar-link">node搭建服务器</a></li><li><a href="/pages/fc31e6/" class="sidebar-link">webPack学习</a></li><li><a href="/pages/debc20/" class="sidebar-link">js原型对象和原型链的理解</a></li><li><a href="/pages/8e9745/" class="sidebar-link">css阻塞与js阻塞</a></li><li><a href="/pages/9be584/" class="sidebar-link">ajax的学习</a></li><li><a href="/pages/4f10b9/" aria-current="page" class="active sidebar-link">浏览器的重绘与重排</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/1273e8/" class="sidebar-link">函数防抖与函数节流学习记录</a></li><li><a href="/pages/0acb8e/" class="sidebar-link">浏览器储存学习</a></li><li><a href="/pages/3eb294/" class="sidebar-link">React起步</a></li><li><a href="/pages/a87c4e/" class="sidebar-link">React的基本使用</a></li><li><a href="/pages/3dc609/" class="sidebar-link">React项目搭建</a></li><li><a href="/pages/07bbe9/" class="sidebar-link">vue中attrs和listeners的使用</a></li><li><a href="/pages/44df8d/" class="sidebar-link">js的精度问题</a></li><li><a href="/pages/91d1b5/" class="sidebar-link">React的状态管理</a></li><li><a href="/pages/b3a247/" class="sidebar-link">yarn和npm的对比</a></li><li><a href="/pages/37e8bf/" class="sidebar-link">websocket的使用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>想过的事</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>踩过的坑</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-a872faba><div class="articleInfo" data-v-a872faba><ul class="breadcrumbs" data-v-a872faba><li data-v-a872faba><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-a872faba></a></li> <li data-v-a872faba><span data-v-a872faba>前端</span></li><li data-v-a872faba><span data-v-a872faba>学过的习</span></li></ul> <div class="info" data-v-a872faba><div title="作者" class="author iconfont icon-touxiang" data-v-a872faba><a href="/img/彦祖.png" target="_blank" title="作者" class="beLink" data-v-a872faba>小火柴</a></div> <!----> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="/img/文章标题图标.png">浏览器的重绘与重排<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h3 id="一、css图层"><a href="#一、css图层" class="header-anchor">#</a> 一、css图层</h3> <ul><li><p>图层的作用：浏览器在渲染一个页面时，会将页面分为很多个图层，图层有大有小，每个图层上有一个或多个节点。在渲染DOM的时候，浏览器所做的工作实际上是：</p> <ol><li>获取DOM后分割为多个图层</li> <li>对每个图层的节点计算样式结果		（Recalculate style--样式重计算）</li> <li>为每个节点生成图形和位置			（Layout--重排,回流）</li> <li>将每个节点绘制填充到图层位图中		（Paint--重绘）</li> <li>图层作为纹理上传至GPU</li> <li>组合多个图层到页面上生成最终屏幕图像	（Composite Layers--图层重组）</li></ol></li> <li><p>图层创建的条件：Chrome浏览器满足以下任意情况就会创建图层：</p> <ol><li>拥有具有3D变换的CSS属性</li> <li>使用加速视频解码的video节点</li> <li>canvas节点</li> <li>CSS3动画的节点</li> <li>拥有CSS加速属性的元素(will-change)</li></ol></li></ul> <p><br><br><br></p> <h3 id="二、重绘-repaint"><a href="#二、重绘-repaint" class="header-anchor">#</a> 二、重绘(Repaint)</h3> <p>概念：重绘是一个元素外观的改变所触发的浏览器行为，例如改变outline、背景色等属性。浏览器会根据元素的新属性重新绘制，使元素呈现新的外观。重绘不会带来重新布局，所以并不一定伴随重排（元素的位置不需要发生变动）。需要注意的是：重绘是以图层为单位，如果图层中某个元素需要重绘，那么整个图层都需要重绘。所以尽量尽量让经常发生重绘的元素处于同一个图层，就可以尽量的减少重绘。</p> <div class="language- extra-class"><pre class="language-text"><code>  
常见的触发重绘的属性：
   * color					    * background					    * outline-color
   * border-style				* background-image				   	* outline
   * border-radius				* background-position				* outline-style
   * visibility					* background-repeat					* outline-width
   * text-decoration			* background-size					* box-shadow


</code></pre></div><p><br><br></p> <h3 id="三、重排-reflow-回流"><a href="#三、重排-reflow-回流" class="header-anchor">#</a> 三、重排（Reflow，回流）</h3> <p>概念：渲染对象在创建完成并添加到渲染树时，并不包含位置和大小信息。计算这些值的过程称为布局或重排。&quot;重绘&quot;不一定需要&quot;重排&quot;，比如改变某个网页元素的颜色，就只会触发&quot;重绘&quot;，不会触发&quot;重排&quot;，因为布局没有改变。但是，&quot;重排&quot;必然导致&quot;重绘&quot;，比如改变一个网页元素的位置，就会同时触发&quot;重排&quot;和&quot;重绘&quot;，因为布局改变了。</p> <div class="language- extra-class"><pre class="language-text"><code>盒子模型相关属性：		        定位属性及浮动：			 	     改变节点内部文字结构：
* width							* top							 * text-align
* height						* bottom				  	     * overflow-y
* padding						* left							 * font-weight
* margin						* right						     * overflow
* display						* position					     * font-family
* border-width			    	* float					         * line-height
* border						* clear					      	 * vertival-align
* min-height													 * white-space
</code></pre></div><p><br><br></p> <h3 id="四、优化"><a href="#四、优化" class="header-anchor">#</a> 四、优化</h3> <p>因为Reflow 的成本比 Repaint 的成本高得多的多。DOM Tree 里的每个结点都会有 reflow 方法，一个结点的 reflow 很有可能导致子结点，甚至父点以及同级结点的 reflow。在一些高性能的电脑上也许还没什么，但是如果 reflow 发生在手机上，那么这个过程是非常痛苦和耗电的。所以，下面这些动作有很大可能会是成本比较高的：</p> <ul><li>你增加、删除、修改 DOM 结点时，会导致 Reflow , Repaint。</li> <li>移动 DOM 的位置</li> <li>修改 CSS 样式的时候。</li> <li>你 Resize 窗口的时候（移动端没有这个问题，因为移动端的缩放没有影响布局视口）</li> <li>修改网页的默认字体时。</li> <li>获取某些属性时(width,height等)</li></ul> <p><strong>注：display:none 会触发 reflow，而 visibility:hidden 只会触发 repaint，因为没有发生位置变化。</strong></p> <h5 id="优化方案"><a href="#优化方案" class="header-anchor">#</a> 优化方案：</h5> <p>如果我们需要使得动画或其他节点渲染的性能提高，需要做的就是减少浏览器在运行时所需要做的工作，具体的步骤在<strong>图层介绍</strong>的时候已经提到。有以下的一些方法：</p> <ul><li><p>元素位置移动变换时尽量使用CSS3的transform来代替对top left等的操作</p></li> <li><p>使用opacity来代替visibility，变换（transform）和透明度（opacity）的改变仅仅影响图层的组合。透明度的改变时，GPU在绘画时只是简单的降低之前已经画好的纹理的alpha值来达到效果，并不需要整体的重绘。不过这个前提是这个被修改opacity本身必须是一个图层。</p></li> <li><p>不要使用table布局</p></li> <li><p>将多次改变样式属性的操作合并成一次操作，不要一条一条地修改DOM的样式，预先定义好class，然后修改DOM的className</p></li> <li><p>将DOM离线后再修改，由于display属性为none的元素不在渲染树中，对隐藏的元素操作不会引发其他元素的重排。如果要对一个元素进行复杂的操作时，可以先隐藏它，操作完成后再显示。这样只在隐藏和显示时触发2次重排。</p></li> <li><p>利用文档碎片(documentFragment)------vue使用了该种方式提升性能。
浏览器都会强行刷新渲染队列。</p></li> <li><p>动画实现过程中，启用GPU硬件加速:transform: tranlateZ(0)</p></li> <li><p>为动画元素新建图层,提高动画元素的z-index</p></li> <li><p>不要把获取某些DOM节点的属性值放在一个循环里当成循环的变量，因为当你请求向浏览器请求一些 style信息的时候，就会让浏览器flush队列，比如如下属性， 当你请求这些属性的时候，浏览器为了给你最精确的值，需要刷新内部队列。因为队列中可能会有影响到这些值的操作。即使你获取元素的布局和样式信息跟最近发生或改变的布局信息无关。</p> <ol><li>offsetTop, offsetLeft, offsetWidth, offsetHeight</li> <li>scrollTop/Left/Width/Height</li> <li>clientTop/Left/Width/Height</li> <li>width,height</li></ol> <p><br><br></p></li></ul> <h3 id="五、requestanimationframe-请求动画帧"><a href="#五、requestanimationframe-请求动画帧" class="header-anchor">#</a> 五、requestAnimationFrame（请求动画帧）</h3> <p>1.window.requestAnimationFrame()</p> <p><strong>说明</strong>：该方法会告诉浏览器在重绘之前调用你所指定的函数
<strong>参数</strong>：该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。<strong>注</strong>：回调函数会被自动传入一个参数，DOMHighResTimeStamp，标识requestAnimationFrame()开始触发回调函数的当前时间
<strong>返回值</strong>： 一个long整数，也成为请求 ID，是个非零值 ，是回调列表中唯一的标识，没别的意义。</p> <p>2.window.cancelAnimationFrame(requestID)</p> <p><strong>作用</strong>：取消一个先前通过调用window.requestAnimationFrame()方法添加到计划中的动画帧请求。requestID是先前调用window.requestAnimationFrame()方法时返回的ID.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义的id为test的div</span>
 
  <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>move<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//event 是传入的参数，标识时间</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> 
    id <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>move<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
  
  <span class="token comment">//3秒后关闭请求动画针</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//通过id去关闭请求动画帧</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=html" title="标签">#html</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9be584/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ajax的学习</div></a> <a href="/pages/1273e8/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">函数防抖与函数节流学习记录</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9be584/" class="prev">ajax的学习</a></span> <span class="next"><a href="/pages/1273e8/">函数防抖与函数节流学习记录</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>X match</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df697a22.js" defer></script><script src="/assets/js/2.7d83501e.js" defer></script><script src="/assets/js/23.0e8e3223.js" defer></script>
  </body>
</html>
