<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js的精度问题 | 小火柴的博客笔记</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="个人使用的笔记">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b02af158.css" as="style"><link rel="preload" href="/assets/js/app.df697a22.js" as="script"><link rel="preload" href="/assets/js/2.7d83501e.js" as="script"><link rel="preload" href="/assets/js/30.5946cdb6.js" as="script"><link rel="prefetch" href="/assets/js/10.e240a3f3.js"><link rel="prefetch" href="/assets/js/11.575cb3b0.js"><link rel="prefetch" href="/assets/js/12.3ff991d5.js"><link rel="prefetch" href="/assets/js/13.26c49407.js"><link rel="prefetch" href="/assets/js/14.c6bbd5c7.js"><link rel="prefetch" href="/assets/js/15.ddd33f09.js"><link rel="prefetch" href="/assets/js/16.b50e0d90.js"><link rel="prefetch" href="/assets/js/17.8b12949a.js"><link rel="prefetch" href="/assets/js/18.78f9b568.js"><link rel="prefetch" href="/assets/js/19.6c28fb1c.js"><link rel="prefetch" href="/assets/js/20.c55312e1.js"><link rel="prefetch" href="/assets/js/21.6240c172.js"><link rel="prefetch" href="/assets/js/22.7a0531a9.js"><link rel="prefetch" href="/assets/js/23.0e8e3223.js"><link rel="prefetch" href="/assets/js/24.ae4b27cd.js"><link rel="prefetch" href="/assets/js/25.267d5425.js"><link rel="prefetch" href="/assets/js/26.0b7f1791.js"><link rel="prefetch" href="/assets/js/27.ad9b7815.js"><link rel="prefetch" href="/assets/js/28.01c71cdd.js"><link rel="prefetch" href="/assets/js/29.a43249ca.js"><link rel="prefetch" href="/assets/js/3.e698f975.js"><link rel="prefetch" href="/assets/js/31.4ed5e15b.js"><link rel="prefetch" href="/assets/js/32.a6c4036d.js"><link rel="prefetch" href="/assets/js/33.32bd6b2e.js"><link rel="prefetch" href="/assets/js/34.b352a9bb.js"><link rel="prefetch" href="/assets/js/35.ba56cab8.js"><link rel="prefetch" href="/assets/js/36.54dc1f48.js"><link rel="prefetch" href="/assets/js/37.dd279648.js"><link rel="prefetch" href="/assets/js/38.536ec31f.js"><link rel="prefetch" href="/assets/js/4.ab898f5f.js"><link rel="prefetch" href="/assets/js/5.e7a2e834.js"><link rel="prefetch" href="/assets/js/6.0e33ec81.js"><link rel="prefetch" href="/assets/js/7.4115f5e1.js"><link rel="prefetch" href="/assets/js/8.3652c984.js"><link rel="prefetch" href="/assets/js/9.5d06d064.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b02af158.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/head.jpg" alt="小火柴的博客笔记" class="logo"> <span class="site-name can-hide">小火柴的博客笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/3eb294/" class="nav-link">学过的习</a></div><div class="nav-item"><a href="/pages/3fea03/" class="nav-link">踩过的坑</a></div><div class="nav-item"><a href="/pages/9a1e83/" class="nav-link">想过的事</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/3eb294/" class="nav-link">学过的习</a></div><div class="nav-item"><a href="/pages/3fea03/" class="nav-link">踩过的坑</a></div><div class="nav-item"><a href="/pages/9a1e83/" class="nav-link">想过的事</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>学过的习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e24a44/" class="sidebar-link">CSS的样式优先级权重</a></li><li><a href="/pages/7873d2/" class="sidebar-link">事件冒泡和事件捕获</a></li><li><a href="/pages/9c2bfc/" class="sidebar-link">js模块可以通过两种方式对外暴露函数</a></li><li><a href="/pages/991cc6/" class="sidebar-link">js中的内存泄漏和内存溢出</a></li><li><a href="/pages/cc931f/" class="sidebar-link">js作用域链</a></li><li><a href="/pages/17c816/" class="sidebar-link">控制台暴露vue</a></li><li><a href="/pages/515843/" class="sidebar-link">es5常用知识总结</a></li><li><a href="/pages/34049a/" class="sidebar-link">es6常用知识总结</a></li><li><a href="/pages/29f30f/" class="sidebar-link">es7常用知识总结</a></li><li><a href="/pages/6616c2/" class="sidebar-link">js模块化</a></li><li><a href="/pages/937e4b/" class="sidebar-link">nodeJs学习</a></li><li><a href="/pages/0a1991/" class="sidebar-link">node搭建服务器</a></li><li><a href="/pages/fc31e6/" class="sidebar-link">webPack学习</a></li><li><a href="/pages/debc20/" class="sidebar-link">js原型对象和原型链的理解</a></li><li><a href="/pages/8e9745/" class="sidebar-link">css阻塞与js阻塞</a></li><li><a href="/pages/9be584/" class="sidebar-link">ajax的学习</a></li><li><a href="/pages/4f10b9/" class="sidebar-link">浏览器的重绘与重排</a></li><li><a href="/pages/1273e8/" class="sidebar-link">函数防抖与函数节流学习记录</a></li><li><a href="/pages/0acb8e/" class="sidebar-link">浏览器储存学习</a></li><li><a href="/pages/3eb294/" class="sidebar-link">React起步</a></li><li><a href="/pages/a87c4e/" class="sidebar-link">React的基本使用</a></li><li><a href="/pages/3dc609/" class="sidebar-link">React项目搭建</a></li><li><a href="/pages/07bbe9/" class="sidebar-link">vue中attrs和listeners的使用</a></li><li><a href="/pages/44df8d/" aria-current="page" class="active sidebar-link">js的精度问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/44df8d/#js中存在的精度问题及解决方案" class="sidebar-link">js中存在的精度问题及解决方案</a></li></ul></li><li><a href="/pages/91d1b5/" class="sidebar-link">React的状态管理</a></li><li><a href="/pages/b3a247/" class="sidebar-link">yarn和npm的对比</a></li><li><a href="/pages/37e8bf/" class="sidebar-link">websocket的使用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>想过的事</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>踩过的坑</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-a872faba><div class="articleInfo" data-v-a872faba><ul class="breadcrumbs" data-v-a872faba><li data-v-a872faba><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-a872faba></a></li> <li data-v-a872faba><span data-v-a872faba>前端</span></li><li data-v-a872faba><span data-v-a872faba>学过的习</span></li></ul> <div class="info" data-v-a872faba><div title="作者" class="author iconfont icon-touxiang" data-v-a872faba><a href="/img/彦祖.png" target="_blank" title="作者" class="beLink" data-v-a872faba>小火柴</a></div> <!----> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="/img/文章标题图标.png">js的精度问题<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="js中存在的精度问题及解决方案"><a href="#js中存在的精度问题及解决方案" class="header-anchor">#</a> js中存在的精度问题及解决方案</h2> <br> <h3 id="一、js中问什么会存在精度问题-为什么0-1-0-2-0-3"><a href="#一、js中问什么会存在精度问题-为什么0-1-0-2-0-3" class="header-anchor">#</a> 一、js中问什么会存在精度问题：为什么0.1+0.2 ！= 0.3？</h3> <p>当将十进制数转换为二进制数时，0.1 和 0.2 都会产生无限循环的二进制表示形式。
这是因为在二进制中，有些小数无法精确表示，就像在十进制中无法精确表示 1/3 一样。<br><br><br> <strong>将 0.1 转换为二进制：</strong></p> <div class="language- extra-class"><pre class="language-text"><code>
乘以 2，得到 0.2，整数部分为 0。
乘以 2，得到 0.4，整数部分为 0。
乘以 2，得到 0.8，整数部分为 0。
乘以 2，得到 1.6，整数部分为 1。
乘以 2，得到 1.2，整数部分为 1。
乘以 2，得到 0.4，整数部分为 0。
乘以 2，得到 0.8，整数部分为 0。
乘以 2，得到 1.6，整数部分为 1。
乘以 2，得到 1.2，整数部分为 1。
继续该过程下去，得到无限循环的二进制表示形式：0.0001100110011...

</code></pre></div><p><strong>将 0.2 转换为二进制：</strong></p> <div class="language- extra-class"><pre class="language-text"><code>
乘以 2，得到 0.4，整数部分为 0。
乘以 2，得到 0.8，整数部分为 0。
乘以 2，得到 1.6，整数部分为 1。
乘以 2，得到 1.2，整数部分为 1。
继续该过程下去，得到无限循环的二进制表示形式：0.001100110011...

</code></pre></div><p>由于这种无限循环，将它们精确表示为二进制是不可能的.
在计算机中，<strong>它们的二进制表示会被截断为有限位数</strong>，从而引入舍入误差。
<br>
因此，在实际计算中，0.1 和 0.2 的精确值不是直接使用它们的二进制表示，而是使用近似值进行计算。 这导致了 0.1 + 0.2 的结果略微偏离于 0.3。
<br><br></p> <h3 id="二、关于精度的解决方案"><a href="#二、关于精度的解决方案" class="header-anchor">#</a> 二、关于精度的解决方案</h3> <br> <p>1、<strong>使用专门的高精度计算库</strong>：可以使用第三方库或语言内置的高精度计算库，这些库提供了更精确的数值计算功能。
例如，在 JavaScript 中，可以使用 Decimal.js、Big.js、math.js 等库来进行高精度计算。
<br></p> <p>2、<strong>使用字符串表示数字实现精确计算</strong>：如果不想依赖外部库，也可以手动实现高精度计算。
一种常见的方法是使用字符串表示数字，然后编写相应的算法来进行精确计算。通过使用字符串表示，可以绕过浮点数的精度问题。 但是，这样做可能会降低计算速度和增加代码复杂性。</p> <br>
```javascript
// 将数字转换为字符串
function numberToString(num) {
  return num.toString();
}
<p>// 去除字符串首尾的0
function trimLeadingAndTrailingZeros(str) {
return str.replace(/^0+|0+$/g, '');
}</p> <p>// 加法
function add(a, b) {
const aStr = numberToString(a);
const bStr = numberToString(b);</p> <p>let carry = 0; // 进位
let result = ''; // 结果</p> <p>let i = aStr.length - 1; // 数字 a 的最后一位索引
let j = bStr.length - 1; // 数字 b 的最后一位索引</p> <p>// 从后往前遍历 a 和 b 的每一位数字，进行相加
while (i &gt;= 0 || j &gt;= 0 || carry &gt; 0) {
const digitA = i &gt;= 0 ? parseInt(aStr[i]) : 0; // 数字 a 的当前位数值，若索引越界则为0
const digitB = j &gt;= 0 ? parseInt(bStr[j]) : 0; // 数字 b 的当前位数值，若索引越界则为0</p> <div class="language- extra-class"><pre><code>// 计算当前位的和，加上进位
const sum = digitA + digitB + carry;
// 更新进位
carry = Math.floor(sum / 10);
// 将当前位的结果添加到结果字符串的开头
result = (sum % 10) + result;

// 移动到下一位
i--;
j--;
</code></pre></div><p>}</p> <p>// 去除首尾无效的0，并返回结果
return trimLeadingAndTrailingZeros(result);
}</p> <p>// 乘法
function multiply(a, b) {
const aStr = numberToString(a);
const bStr = numberToString(b);</p> <p>const products = []; // 存储各位乘积的临时数组</p> <p>// 从 a 的最后一位开始遍历
for (let i = aStr.length - 1; i &gt;= 0; i--) {
let carry = 0; // 进位
let product = ''; // 当前位的乘积</p> <div class="language- extra-class"><pre><code>// 从 b 的最后一位开始遍历
for (let j = bStr.length - 1; j &gt;= 0; j--) {
  const digitA = parseInt(aStr[i]); // 数字 a 的当前位数值
  const digitB = parseInt(bStr[j]); // 数字 b 的当前位数值

  // 计算当前位的乘积，加上进位
  const partialProduct = digitA * digitB + carry;
  // 更新进位
  carry = Math.floor(partialProduct / 10);
  // 将当前位的结果添加到当前乘积的开头
  product = (partialProduct % 10) + product;
}

// 若进位大于0，则将其添加到当前乘积的开头
if (carry &gt; 0) {
  product = carry + product;
}

// 添加0，相当于当前位乘积的位数向左移动
product += '0'.repeat(aStr.length - i - 1);
// 将当前位的乘积添加到临时数组中
products.push(product);
</code></pre></div><p>}</p> <p>// 将各位乘积相加，得到最终结果
let result = '0';
for (const product of products) {
result = add(result, product);
}</p> <p>// 去除首尾无效的0，并返回结果
return trimLeadingAndTrailingZeros(result);
}</p> <p>// 示例
const a = '0.1';
const b = '0.2';
const sum = add(a, b);
console.log(sum); // 输出：&quot;0.3&quot;</p> <p>const product = multiply(a, b);
console.log(product); // 输出：&quot;0.02&quot;</p> <div class="language- extra-class"><pre class="language-text"><code>
[//]: # (3、调整计算顺序：有时，通过重新排列计算顺序可以减少舍入误差的影响。)

[//]: # (   例如，如果某个计算顺序导致大数与小数相加，可以尽量将相似大小的数值进行相加，然后再进行舍入。这样可以减小舍入误差的累积效应。)
&lt;br/&gt;&lt;br/&gt;

3、**使用整数计算**：对于需要高精度的货币计算等场景，可以将小数转换为整数，进行整数计算，然后再将结果转换回小数形式。
   这可以避免浮点数精度问题，因为整数计算没有舍入误差。
&lt;br/&gt;
```javascript
function decimalToIntegerCalculation(a, b, operator) {
  // 将小数转换成整数
  const precision = Math.max(getPrecision(a), getPrecision(b));
  const integerA = a * Math.pow(10, precision);
  const integerB = b * Math.pow(10, precision);

  // 进行整数运算
  let result;
  switch (operator) {
    case '+':
      result = integerA + integerB;
      break;
    case '-':
      result = integerA - integerB;
      break;
    case '*':
      result = (integerA * integerB) / Math.pow(10, precision * 2);
      break;
    case '/':
      result = integerA / integerB;
      break;
    default:
      throw new Error(&quot;Invalid operator&quot;);
  }

  // 将结果转回小数形式
  return result / Math.pow(10, precision);
}

// 获取小数的精度
function getPrecision(number) {
  const str = number.toString();
  const decimalIndex = str.indexOf(&quot;.&quot;);
  return decimalIndex === -1 ? 0 : str.length - decimalIndex - 1;
}

// 示例
const a = 0.1;
const b = 0.2;
const sum = decimalToIntegerCalculation(a, b, '+');
console.log(sum); // Output: 0.3

</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=javaScript" title="标签">#javaScript</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/07bbe9/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">vue中attrs和listeners的使用</div></a> <a href="/pages/91d1b5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">React的状态管理</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/07bbe9/" class="prev">vue中attrs和listeners的使用</a></span> <span class="next"><a href="/pages/91d1b5/">React的状态管理</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>X match</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df697a22.js" defer></script><script src="/assets/js/2.7d83501e.js" defer></script><script src="/assets/js/30.5946cdb6.js" defer></script>
  </body>
</html>
